# SAI Dashboard Environment Configuration - PRODUCTION
# This file contains ONLY actively used environment variables
# Last cleaned: 2025-10-12

# =================================================================
# DATABASE CONFIGURATION (Dual-Database Architecture)
# =================================================================

# N8N Database Configuration (Source - Read Only for ETL)
N8N_DB_HOST=localhost
N8N_DB_PORT=5432
N8N_DB_NAME=n8n
N8N_DB_USER=n8n_user
N8N_DB_PASSWORD=<your-db-password>

# SAI Dashboard Database (Optimized Schema - Read/Write)
SAI_DB_HOST=localhost
SAI_DB_PORT=5432
SAI_DB_NAME=sai_dashboard
SAI_DB_USER=n8n_user
SAI_DB_PASSWORD=<your-db-password>

# Connection pool settings
DB_MAX_CONNECTIONS=5
DB_IDLE_TIMEOUT=30000
DB_CONNECTION_TIMEOUT=2000

# =================================================================
# APPLICATION CONFIGURATION
# =================================================================

# Environment (development, production)
NODE_ENV=production

# Server port for API (binds to localhost only in production)
API_PORT=3001

# API base path for subpath deployment
API_BASE_PATH=/dashboard/api

# Frontend environment variables (Vite)
VITE_BASE_PATH=/dashboard/
VITE_API_URL=/dashboard/api

# CORS configuration
CORS_ORIGIN=https://sai.altermundi.net
CORS_CREDENTIALS=true

# =================================================================
# SAI DASHBOARD SPECIFIC SETTINGS
# =================================================================

# Target workflow name (do not change unless workflow is renamed)
SAI_WORKFLOW_NAME=Sai-webhook-upload-image+Ollama-analisys+telegram-sendphoto

# SAI Workflow ID (n8n internal ID)
SAI_WORKFLOW_ID=yDbfhooKemfhMIkC

# Pagination and limits
DEFAULT_PAGE_SIZE=50
MAX_PAGE_SIZE=200
MAX_DAYS_LOOKBACK=365

# =================================================================
# IMAGE STORAGE & PROCESSING
# =================================================================

# Filesystem cache configuration (primary storage method)
CACHE_PATH=/mnt/raid1/n8n-backup/images
IMAGE_BASE_PATH=/mnt/raid1/n8n-backup/images

# n8n binary storage path (filesystem-v2 location where n8n stores uploaded files)
N8N_BINARY_DATA_PATH=/mnt/n8n-data/.n8n/binaryData

# Thumbnail generation
ENABLE_THUMBNAIL_GENERATION=true
THUMBNAIL_SIZE=200
THUMBNAIL_QUALITY=70

# Image processing limits
MAX_IMAGE_SIZE=5242880  # 5MB in bytes
SUPPORTED_IMAGE_FORMATS=jpeg,png,webp
IMAGE_CACHE_TTL=86400   # 24 hours

# =================================================================
# SECURITY CONFIGURATION
# =================================================================

# === Zitadel OIDC Authentication (REQUIRED) ===
# Zitadel issuer URL (your Zitadel instance)
AUTH_ZITADEL_ISSUER=https://auth.altermundi.net

# Client ID from the Zitadel project application
AUTH_ZITADEL_ID=<client-id-del-proyecto-sai-dashboard>

# Client Secret (leave empty for PKCE public clients)
AUTH_ZITADEL_SECRET=

# OIDC redirect URI (must match exactly what is registered in Zitadel)
AUTH_REDIRECT_URI=https://sai.altermundi.net/dashboard/api/auth/callback

# Post-logout redirect URI (where Zitadel sends users after logout)
AUTH_POST_LOGOUT_URI=https://sai.altermundi.net/dashboard/

# Zitadel Management API (for programmatic role assignment)
# Project Resource ID: Zitadel → Projects → SAI Dashboard → General → Resource ID
ZITADEL_PROJECT_ID=<project-resource-id>
# Service account private key JSON (download from Zitadel → Users → <machine> → Keys)
# Paste entire JSON as a single line (key PEM newlines stay as literal \n inside the string)
ZITADEL_MGMT_KEY_JSON={"type":"serviceaccount","keyId":"...","key":"-----BEGIN RSA PRIVATE KEY-----\n...\n-----END RSA PRIVATE KEY-----\n","userId":"..."}

# Session management (REQUIRED)
# WARNING: Change SESSION_SECRET to a strong random value (32+ bytes)!
SESSION_SECRET=your-super-secret-session-key-change-this-in-production
SESSION_DURATION=86400  # 24 hours in seconds

# Security headers
TRUST_PROXY=true
ENFORCE_HTTPS=true

# =================================================================
# RATE LIMITING
# =================================================================

# General API rate limiting
RATE_LIMIT_WINDOW_MS=60000      # 1 minute
RATE_LIMIT_MAX_REQUESTS=10000   # requests per window
RATE_LIMIT_BURST_MAX=2000       # burst requests
RATE_LIMIT_BURST_WINDOW=10000   # 10 seconds

# Login rate limiting (applies to token refresh endpoints)
LOGIN_RATE_LIMIT_WINDOW=900000  # 15 minutes
LOGIN_RATE_LIMIT_MAX=5          # 5 attempts per 15 min

# =================================================================
# LOGGING CONFIGURATION
# =================================================================

# Log level: error, warn, info, debug
LOG_LEVEL=info

# Log format: json, simple
LOG_FORMAT=simple

# Log file path (optional, logs to console if not set)
LOG_FILE_PATH=

# Enable database query logging (use for debugging only)
LOG_DATABASE_QUERIES=false

# =================================================================
# SSE (Server-Sent Events) CONFIGURATION
# =================================================================

# Real-time updates configuration
SSE_HEARTBEAT_INTERVAL=3000  # 3 seconds (fast for testing)
SSE_MAX_CLIENTS=100
SSE_TIMEOUT=300000           # 5 minutes
SSE_DEBUG=true               # Enable SSE debug mode and endpoints

# =================================================================
# HEALTH CHECK & MONITORING
# =================================================================

# Health check configuration
HEALTH_CHECK_TIMEOUT=5000  # 5 seconds
ENABLE_SYSTEM_METRICS=true

# =================================================================
# FEATURE FLAGS
# =================================================================

# Enable/disable specific features
FEATURE_IMAGE_PROCESSING=true
FEATURE_REAL_TIME_UPDATES=true
FEATURE_EXPORT_FUNCTIONALITY=true
ENABLE_DEV_TOOLS=true

# =================================================================
# ETL SERVICE CONFIGURATION
# =================================================================

# ETL Service (Enable/disable background processing)
ENABLE_ETL_SERVICE=true

# Use new 2-stage ETL architecture (recommended)
USE_TWO_STAGE_ETL=true
